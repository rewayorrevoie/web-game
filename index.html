<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Quest Explorer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Orbitron:wght@400;700&display=swap');
        
        body { 
            font-family: 'Orbitron', monospace; 
            text-align: center; 
            background: linear-gradient(135deg, #0c0c0c, #1a1a2e, #16213e); 
            color: #fff; 
            margin: 0; 
            padding: 0; 
            min-height: 100vh;
        }
        #menu-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            opacity: 0.25;
        }
        h1 { 
            font-family: 'Creepster', cursive;
            font-size: 5rem; 
            margin: 20px 0 10px;
            text-shadow: 0 0 20px #00ffaa, 0 0 40px #ff00ff;
            animation: neon-glow 3s infinite alternate;
        }
        @keyframes neon-glow {
            from { text-shadow: 0 0 10px #00ffaa, 0 0 20px #00ffaa, 0 0 30px #ff00ff; }
            to   { text-shadow: 0 0 20px #00ffaa, 0 0 40px #ff00ff, 0 0 60px #ff00ff; }
        }
        .menu-section {
            background: rgba(10,10,30,0.75);
            border: 2px solid #00ffaa;
            border-radius: 16px;
            padding: 30px;
            margin: 20px auto;
            max-width: 550px;
            box-shadow: 0 0 40px rgba(0,255,170,0.4);
        }
        input { 
            padding: 14px; 
            font-size: 18px; 
            width: 320px; 
            border: 2px solid #00ffaa;
            border-radius: 10px;
            background: rgba(255,255,255,0.08);
            color: white;
            text-align: center;
        }
        .choice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        .choice-btn {
            padding: 16px;
            font-size: 17px;
            border: 2px solid #00ffaa;
            border-radius: 12px;
            background: rgba(0,255,170,0.15);
            color: white;
            cursor: pointer;
            transition: all 0.25s;
        }
        .choice-btn:hover { background: rgba(0,255,170,0.4); transform: scale(1.05); }
        .choice-btn.selected { 
            background: linear-gradient(135deg, #00ffaa, #ff00ff); 
            box-shadow: 0 0 25px #00ffaa; 
            transform: scale(1.08);
        }
        #start-btn {
            padding: 18px 50px;
            font-size: 22px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            background: linear-gradient(45deg, #00ffaa, #ff00ff, #00ffaa);
            background-size: 200% 200%;
            animation: gradient 6s ease infinite;
            color: black;
            cursor: pointer;
            margin-top: 20px;
        }
        #start-btn:hover { transform: scale(1.1); box-shadow: 0 0 40px #00ffaa; }
        #start-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        @keyframes gradient { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }

        canvas.game { 
            border: 3px solid #00ffaa; 
            border-radius: 12px;
            box-shadow: 0 0 35px rgba(0,255,170,0.5);
            background: #000;
            display: block; 
            margin: 25px auto;
        }
        #log { 
            width: 90%; max-width: 720px;
            height: 220px; 
            margin: 20px auto;
            padding: 15px;
            background: rgba(0,0,20,0.85);
            border: 2px solid #00ffaa;
            border-radius: 10px;
            overflow-y: auto;
            text-align: left;
            font-size: 15px;
            line-height: 1.5;
        }
        .btn-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            gap: 12px;
            max-width: 720px;
            margin: 25px auto;
        }
        button.action {
            padding: 14px 20px;
            font-size: 16px;
            border: 2px solid #00ffaa;
            border-radius: 10px;
            background: rgba(0,255,170,0.2);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        button.action:hover:not(:disabled) {
            background: rgba(0,255,170,0.5);
            box-shadow: 0 0 20px #00ffaa;
        }
        button.action:disabled { opacity: 0.4; cursor: not-allowed; }
        .stats-panel {
            position: absolute;
            top: 15px; left: 15px;
            background: rgba(0,0,0,0.7);
            border: 1px solid #00ffaa;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            z-index: 10;
        }
        .monster-panel {
            position: absolute;
            top: 15px; right: 15px;
            background: rgba(100,0,0,0.7);
            border: 1px solid #ff4444;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            display: none;
            z-index: 10;
        }
    </style>
</head>
<body>

    <canvas id="menu-canvas"></canvas>

    <div id="start-screen">
        <h1>AI Quest Explorer</h1>

        <div class="menu-section">
            <p style="font-size: 1.4rem; margin-bottom: 20px;">–ü—Ä–æ–±—É–¥–∏ –ª–µ–≥–µ–Ω–¥—É –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è</p>
            
            <input type="text" id="player-name" placeholder="–ò–º—è –≥–µ—Ä–æ—è...">
            
            <div style="margin: 30px 0 10px; font-size: 1.2rem;">–í—ã–±–µ—Ä–∏ –∫–ª–∞—Å—Å:</div>
            <div class="choice-grid">
                <button class="choice-btn" data-class="warrior" onclick="selectClass('warrior')">üõ°Ô∏è –í–æ–∏–Ω<br><small>+30 HP</small></button>
                <button class="choice-btn" data-class="mage"    onclick="selectClass('mage')">üîÆ –ú–∞–≥<br><small>+ —É—Ä–æ–Ω</small></button>
                <button class="choice-btn" data-class="archer"  onclick="selectClass('archer')">üèπ –õ—É—á–Ω–∏–∫<br><small>—É–∫–ª–æ–Ω–µ–Ω–∏–µ</small></button>
            </div>

            <div style="margin: 30px 0 10px; font-size: 1.2rem;">–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</div>
            <div class="choice-grid">
                <button class="choice-btn" data-diff="easy"   onclick="selectDifficulty('easy')">üòä –õ—ë–≥–∫–∞—è</button>
                <button class="choice-btn" data-diff="normal" onclick="selectDifficulty('normal')">‚öîÔ∏è –ù–æ—Ä–º–∞–ª—å–Ω–∞—è</button>
                <button class="choice-btn" data-diff="hard"   onclick="selectDifficulty('hard')">‚ò†Ô∏è –•–∞—Ä–¥–∫–æ—Ä</button>
            </div>

            <button id="start-btn" disabled onclick="startGame()">–ù–∞—á–∞—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</button>
        </div>
    </div>

    <div id="game-screen" style="display:none; position:relative;">
        <div class="stats-panel" id="player-stats"></div>
        <div class="monster-panel" id="monster-stats"></div>

        <h1 style="font-size:3rem; margin:15px 0;">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –Ω–∞—á–∞–ª–æ—Å—å</h1>
        <canvas id="game-canvas" class="game" width="500" height="350"></canvas>
        <div id="log"></div>

        <div class="btn-grid">
            <button class="action" onclick="move('north')">‚Üë –°–µ–≤–µ—Ä</button>
            <button class="action" onclick="move('south')">‚Üì –Æ–≥</button>
            <button class="action" onclick="move('west')">‚Üê –ó–∞–ø–∞–¥</button>
            <button class="action" onclick="move('east')">‚Üí –í–æ—Å—Ç–æ–∫</button>
            <button class="action" onclick="fight()">‚öîÔ∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å</button>
            <button class="action" onclick="collect()">üíé –°–æ–±—Ä–∞—Ç—å</button>
        </div>
    </div>

    <div id="end-screen" style="display:none;">
        <h1>–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</h1>
        <p id="end-message" style="font-size:1.8rem; margin:30px;"></p>
        <button onclick="location.reload()" style="padding:18px 40px; font-size:20px;">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>

    <script>
        // ==================== –ù–ê–°–¢–†–û–ô–ö–ò –°–õ–û–ñ–ù–û–°–¢–ò ====================
        const difficultySettings = {
            easy:   { hpMult: 1.5, damageMult: 0.6, hitChance: 0.75, artifactGoal: 3, eventChance: 0.7 },
            normal: { hpMult: 1.0, damageMult: 1.0, hitChance: 0.55, artifactGoal: 4, eventChance: 0.5 },
            hard:   { hpMult: 0.7,  damageMult: 1.5, hitChance: 0.40, artifactGoal: 5, eventChance: 0.4 }
        };

        // ==================== –†–ê–ù–î–û–ú–ù–´–ï –°–û–ë–´–¢–ò–Ø ====================
        const randomEvents = [
            "–¢—ã –Ω–∞—à—ë–ª —Å—Ç–∞—Ä–æ–µ –∑–µ–ª—å–µ! +20 HP",
            "–¢—ã —Å–ø–æ—Ç–∫–Ω—É–ª—Å—è –æ –∫–æ—Ä–µ–Ω—å... -15 HP",
            "–í–Ω–µ–∑–∞–ø–Ω—ã–π –ø–æ—Ä—ã–≤ –≤–µ—Ç—Ä–∞... –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ",
            "–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —à–µ–ø–æ—Ç: '–ò–¥–∏ –¥–∞–ª—å—à–µ, –≥–µ—Ä–æ–π...'",
            "–¢—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª —Å—Ç—Ä–∞–Ω–Ω–∏–∫–∞! –û–Ω –¥–∞–ª –ø–æ–¥—Å–∫–∞–∑–∫—É, –Ω–æ —Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–Ω—è–ª",
            "–ú–∞–ª–µ–Ω—å–∫–æ–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ! +1 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç",
            "–õ–æ–≤—É—à–∫–∞! -25 HP, –Ω–æ —Ç—ã –≤—ã–∂–∏–ª",
            "–¢—ã –Ω–∞—à—ë–ª –º–∞–≥–∏—á–µ—Å–∫–∏–π –≥—Ä–∏–±... +10 HP, –Ω–æ -5 —É—Ä–æ–Ω–∞ –Ω–∞ –≤—Ä–µ–º—è",
            "–°—Ç–∞—è –ª–µ—Ç—É—á–∏—Ö –º—ã—à–µ–π –Ω–∞–ø—É–≥–∞–ª–∞ —Ç–µ–±—è... -10 HP",
            "–°–æ–ª–Ω–µ—á–Ω—ã–π –ª—É—á –ø—Ä–æ–±–∏–ª—Å—è —Å–∫–≤–æ–∑—å —Ç—É—á–∏... +15 HP"
        ];

        // ==================== –î–ê–ù–ù–´–ï –ò–ì–†–û–ö–ê ====================
        let player = {
            name: '',
            class: '',
            difficulty: '',
            hp: 100,
            maxHp: 100,
            damage: 20,
            dodge: 0.1,
            critChance: 0.1,
            artifacts: 0,
            position: {x:0, y:0}
        };

        let currentDifficulty = difficultySettings.normal;

        // ==================== –õ–û–ö–ê–¶–ò–ò ====================
        const locations = [
            {name:'–õ–µ—Å',     baseDesc:'–¢—ë–º–Ω—ã–π –ª–µ—Å –ø–æ–ª–æ–Ω —à–æ—Ä–æ—Ö–æ–≤...'},
            {name:'–ì–æ—Ä–∞',    baseDesc:'–•–æ–ª–æ–¥–Ω—ã–µ –≤–µ—Ç—Ä–∞ –≥–æ—Ä...'},
            {name:'–ü–µ—â–µ—Ä–∞',  baseDesc:'–¢—å–º–∞ –∏ —ç—Ö–æ —à–∞–≥–æ–≤...'},
            {name:'–†–µ–∫–∞',    baseDesc:'–ë—ã—Å—Ç—Ä—ã–µ –≤–æ–¥—ã —Å–∫—Ä—ã–≤–∞—é—Ç —Ç–∞–π–Ω—ã...'},
            {name:'–ó–∞–º–æ–∫',   baseDesc:'–î—Ä–µ–≤–Ω–∏–π –∑–∞–º–æ–∫ –ø–æ–ª–æ–Ω –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π...'}
        ];

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const logEl = document.getElementById('log');

        // ==================== –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø ====================
        let images = {};

        function loadImages() {
            const imgList = [
                { key: 'player', file: 'player.png' },
                // –î–æ–±–∞–≤—å —Å–≤–æ–∏ —Ñ–æ–Ω—ã, –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª—ã
                { key: '–õ–µ—Å',    file: 'les.png' },     // –∏–ª–∏ forest.png ‚Äî –ø–æ–¥—Å—Ç–∞–≤—å —Å–≤–æ—ë –∏–º—è
                { key: '–ì–æ—Ä–∞',   file: 'gora.png' },
                { key: '–ü–µ—â–µ—Ä–∞', file: 'peshera.png' },
                { key: '–†–µ–∫–∞',   file: 'reka.png' },
                { key: '–ó–∞–º–æ–∫',  file: 'zamok.png' }
            ];

            imgList.forEach(item => {
                const img = new Image();
                img.src = 'assets/' + item.file;
                images[item.key] = img;

                img.onload = () => console.log(`–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: assets/${item.file}`);
                img.onerror = () => console.error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å: assets/${item.file} ‚Äî –ø—Ä–æ–≤–µ—Ä—å –∏–º—è —Ñ–∞–π–ª–∞ –∏ –ø–∞–ø–∫—É assets`);
            });
        }

        // ==================== –í–´–ë–û–† –ö–õ–ê–°–°–ê –ò –°–õ–û–ñ–ù–û–°–¢–ò ====================
        function selectClass(cls) {
            document.querySelectorAll('[data-class]').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            player.class = cls;
            checkReady();
        }

        function selectDifficulty(diff) {
            document.querySelectorAll('[data-diff]').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            player.difficulty = diff;
            currentDifficulty = difficultySettings[diff];
            checkReady();
        }

        function checkReady() {
            document.getElementById('start-btn').disabled = !(player.class && player.difficulty);
        }

        // ==================== –ó–ê–ü–£–°–ö –ò–ì–†–´ ====================
        function startGame() {
            player.name = document.getElementById('player-name').value.trim() || '–ë–µ–∑—ã–º—è–Ω–Ω—ã–π';
            
            // –ë–æ–Ω—É—Å—ã –∫–ª–∞—Å—Å–∞
            if (player.class === 'warrior') { player.maxHp += 30; player.hp = player.maxHp; player.critChance += 0.05; }
            if (player.class === 'mage')    { player.damage += 15; player.critChance += 0.1; }
            if (player.class === 'archer')  { player.dodge += 0.15; player.critChance += 0.08; }

            // –°–ª–æ–∂–Ω–æ—Å—Ç—å
            player.maxHp = Math.round(player.maxHp * currentDifficulty.hpMult);
            player.hp = player.maxHp;
            player.damage = Math.round(player.damage * currentDifficulty.damageMult);

            loadImages();  // ‚Üê –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';

            log(`<b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${player.name} ‚Äî –≤–µ–ª–∏–∫–∏–π ${player.class}!</b><br>–¢–≤–æ–π –ø—É—Ç—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...`);
            enterLocation(0);
            updateStats();
        }

        function log(msg) {
            logEl.innerHTML += `<div>${msg}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function updateStats() {
            document.getElementById('player-stats').innerHTML = `
                <b>${player.name}</b><br>
                –ö–ª–∞—Å—Å: ${player.class}<br>
                HP: ${player.hp}/${player.maxHp}<br>
                –£—Ä–æ–Ω: ${player.damage}<br>
                –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: ${player.artifacts}/${currentDifficulty.artifactGoal}
            `;
        }

        function triggerRandomEvent() {
            if (Math.random() < currentDifficulty.eventChance) {
                const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
                log(`‚ú® <span style="color:#ffcc00">–°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ:</span> ${event}`);
                
                if (event.includes("+")) {
                    const val = parseInt(event.match(/\d+/)[0]);
                    if (event.includes("HP")) player.hp = Math.min(player.maxHp, player.hp + val);
                    if (event.includes("–∞—Ä—Ç–µ—Ñ–∞–∫—Ç")) player.artifacts++;
                }
                if (event.includes("-")) {
                    const dmg = parseInt(event.match(/\d+/)[0]);
                    player.hp -= dmg;
                    if (player.hp <= 0) endGame("–°–ª—É—á–∞–π–Ω–æ—Å—Ç—å –æ–∫–∞–∑–∞–ª–∞—Å—å —Ä–æ–∫–æ–≤–æ–π... –¢—ã –ø–æ–≥–∏–±.");
                }
                updateStats();
            }
        }

        function enterLocation(idx) {
            const loc = locations[idx % locations.length];
            const variation = Math.random() < 0.5 ? "–¢–µ–Ω–∏ —à–µ–≤–µ–ª—è—Ç—Å—è..." : "–¢—ã —á—É–≤—Å—Ç–≤—É–µ—à—å —á—å—ë-—Ç–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ...";
            log(`<b>‚ú¶ ${loc.name}</b><br>${loc.baseDesc} ${variation}`);
            
            triggerRandomEvent();
            
            drawScene(loc);
            if (Math.random() < 0.6) log('–ß—Ç–æ-—Ç–æ —Ä—ã—á–∏—Ç –≤ —Ç–µ–Ω—è—Ö...');
            if (Math.random() < 0.5) log('–¢—ã —á—É–≤—Å—Ç–≤—É–µ—à—å –º–∞–≥–∏—á–µ—Å–∫–æ–µ —Å–∏—è–Ω–∏–µ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏!');
        }

        function drawScene(loc) {
            ctx.clearRect(0,0,canvas.width,canvas.height);

            // –§–æ–Ω
            const bgKey = loc.name;
            const bgImage = images[bgKey];
            if (bgImage && bgImage.complete && bgImage.naturalHeight !== 0) {
                ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height);
            } else {
                ctx.fillStyle = '#0a0a1f';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#888';
                ctx.font = '20px Arial';
                ctx.fillText(`–§–æ–Ω ${loc.name} (–Ω–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏)`, 80, 100);
            }

            // –ü–µ—Ä—Å–æ–Ω–∞–∂
            const playerImg = images['player'];
            if (playerImg && playerImg.complete && playerImg.naturalHeight !== 0) {
                ctx.drawImage(playerImg, 180, 150, 140, 140);  // –ø–æ–¥—Å—Ç—Ä–æ–π —Ä–∞–∑–º–µ—Ä/–ø–æ–∑–∏—Ü–∏—é –ø–æ–¥ —Å–≤–æ—é –∫–∞—Ä—Ç–∏–Ω–∫—É
            } else {
                ctx.fillStyle = '#ff00ff';
                ctx.fillRect(220, 180, 60, 100);
                ctx.fillStyle = '#fff';
                ctx.font = '20px Arial';
                ctx.fillText(player.class[0].toUpperCase(), 235, 240);
            }

            // –ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –ø–æ–≤–µ—Ä—Ö
            ctx.fillStyle = '#00ffaa';
            ctx.font = 'bold 30px Orbitron';
            ctx.fillText(loc.name, 40, 60);
        }

        function move(dir) {
            if (dir==='north') player.position.y++;
            if (dir==='south') player.position.y--;
            if (dir==='east')  player.position.x++;
            if (dir==='west')  player.position.x--;
            
            const idx = Math.abs(player.position.x + player.position.y * 3) % locations.length;
            log(`–¢—ã –∏–¥—ë—à—å –Ω–∞ ${dir}...`);
            
            if (Math.random() < 0.35) {
                const effect = Math.random() < 0.6 ? 10 : -12;
                player.hp += effect;
                log(effect > 0 
                    ? `–°–≤–µ–∂–∏–π –≤–µ—Ç–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª ${effect} HP` 
                    : `–£—Å—Ç–∞–ª–æ—Å—Ç—å –≤–∑—è–ª–∞ —Å–≤–æ—ë... -${Math.abs(effect)} HP`);
                if (player.hp <= 0) endGame("–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –æ–∫–∞–∑–∞–ª–æ—Å—å —Å–ª–∏—à–∫–æ–º —Ç—è–∂—ë–ª—ã–º...");
            }
            
            triggerRandomEvent();
            enterLocation(idx);
            updateStats();
        }

        function fight() {
            if (Math.random() < player.dodge) {
                log('–¢—ã –ª–æ–≤–∫–æ —É–∫–ª–æ–Ω–∏–ª—Å—è –æ—Ç –∞—Ç–∞–∫–∏!');
                return;
            }
            
            const isCrit = Math.random() < player.critChance;
            let playerDmg = player.damage + Math.floor(Math.random() * 10);
            if (isCrit) {
                playerDmg *= 2;
                log(`<span style="color:#ffcc00">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä!</span> –¢—ã –Ω–∞–Ω—ë—Å ${playerDmg} —É—Ä–æ–Ω–∞!`);
            } else {
                log(`–¢—ã –Ω–∞–Ω—ë—Å ${playerDmg} —É—Ä–æ–Ω–∞ –º–æ–Ω—Å—Ç—Ä—É!`);
            }

            const monsterHit = Math.random() < currentDifficulty.hitChance;
            if (monsterHit) {
                const monsterDmg = Math.round((10 + Math.random()*20) * currentDifficulty.damageMult);
                player.hp -= monsterDmg;
                log(`–ú–æ–Ω—Å—Ç—Ä –Ω–∞–Ω—ë—Å ${monsterDmg} —É—Ä–æ–Ω–∞! –û—Å—Ç–∞–ª–æ—Å—å ${player.hp} HP`);
                if (player.hp <= 0) endGame('–¢—ã –ø–∞–ª –≤ –±–æ—é... –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.');
            } else {
                log('–ú–æ–Ω—Å—Ç—Ä –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è!');
            }
            updateStats();
        }

        function collect() {
            player.artifacts++;
            log(`–ê—Ä—Ç–µ—Ñ–∞–∫—Ç —Å–æ–±—Ä–∞–Ω! –¢–µ–ø–µ—Ä—å ${player.artifacts}/${currentDifficulty.artifactGoal}`);
            
            if (Math.random() < 0.45) {
                const bonusType = Math.floor(Math.random() * 4);
                if (bonusType === 0) {
                    const heal = 15 + Math.floor(Math.random()*15);
                    player.hp = Math.min(player.maxHp, player.hp + heal);
                    log(`–ê—Ä—Ç–µ—Ñ–∞–∫—Ç –∏—Å—Ü–µ–ª–∏–ª —Ç–µ–±—è –Ω–∞ ${heal} HP!`);
                } else if (bonusType === 1) {
                    const dmgBoost = 5 + Math.floor(Math.random()*10);
                    player.damage += dmgBoost;
                    log(`–ê—Ä—Ç–µ—Ñ–∞–∫—Ç —É—Å–∏–ª–∏–ª —Ç–≤–æ—ë –æ—Ä—É–∂–∏–µ! +${dmgBoost} —É—Ä–æ–Ω–∞ –Ω–∞–≤—Å–µ–≥–¥–∞`);
                } else if (bonusType === 2) {
                    player.dodge += 0.1;
                    log('–ê—Ä—Ç–µ—Ñ–∞–∫—Ç —Å–¥–µ–ª–∞–ª —Ç–µ–±—è –ª–æ–≤—á–µ–µ! +10% —É–∫–ª–æ–Ω–µ–Ω–∏—è');
                } else {
                    log('–ê—Ä—Ç–µ—Ñ–∞–∫—Ç —à–µ–ø—á–µ—Ç –∑–∞–≥–∞–¥–∫—É... –Ω–æ —Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–Ω—è–ª');
                }
            }
            
            if (player.artifacts >= currentDifficulty.artifactGoal) {
                endGame(`–¢—Ä–∏—É–º—Ñ! –¢—ã —Å–æ–±—Ä–∞–ª ${player.artifacts} –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ –∏–∑–º–µ–Ω–∏–ª —Å—É–¥—å–±—É –º–∏—Ä–∞!`);
            }
            updateStats();
        }

        function endGame(msg) {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('end-screen').style.display = 'block';
            document.getElementById('end-message').innerText = msg;
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –∑–≤—ë–∑–¥ –≤ –º–µ–Ω—é
        const menuCanvas = document.getElementById('menu-canvas');
        const mCtx = menuCanvas.getContext('2d');
        menuCanvas.width = window.innerWidth;
        menuCanvas.height = window.innerHeight;

        let stars = [];
        for(let i = 0; i < 180; i++){
            stars.push({
                x: Math.random() * menuCanvas.width,
                y: Math.random() * menuCanvas.height,
                size: Math.random() * 2 + 0.5,
                speed: Math.random() * 0.6 + 0.1
            });
        }

        function animateMenu() {
            mCtx.clearRect(0,0,menuCanvas.width,menuCanvas.height);
            stars.forEach(s => {
                mCtx.fillStyle = 'rgba(255,255,255,0.8)';
                mCtx.fillRect(s.x, s.y, s.size, s.size);
                s.y += s.speed;
                if(s.y > menuCanvas.height) s.y = -s.size;
            });
            requestAnimationFrame(animateMenu);
        }
        animateMenu();

        window.addEventListener('resize', () => {
            menuCanvas.width = window.innerWidth;
            menuCanvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
